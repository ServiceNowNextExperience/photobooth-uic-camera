<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ux_lib_source_script">
    <sys_ux_lib_source_script action="INSERT_OR_UPDATE">
        <config_option/>
        <engine>6</engine>
        <externals/>
        <inner_components/>
        <name>@snc/photobooth-uic-camera</name>
        <script><![CDATA[var __TECTONIC__$snc_photobooth_uic_camera=function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=9)}([function(e,t){e.exports=__TECTONIC__$servicenow_ui_renderer_snabbdom},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getConnectedDevices=function(e,t){navigator.mediaDevices.enumerateDevices().then(function(n){var r=n.filter(function(t){return t.kind===e});t(r)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&c.return&&c.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(e,t,n,a,i,o){var c=r(o,2),u=c[0],d=void 0===u?0:u,s=c[1],l=void 0===s?0:s,f=a/2-t/2,p=i/2-n/2;switch(e){case"top-left":return[0+d,0+l];case"top-center":return[f,0+l];case"top-right":return[a-t+d,0+l];case"bottom-left":return[0+d,i-n+l];case"bottom-center":return[f+d,i-n+l];case"bottom-right":return[a-t+d,i-n+l];case"center":return[f+d,p+l];default:return[0,0]}};t.getCoordinates=a},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var a=function(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}(r),i=r.sources.map(function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"});return[n].concat(i).concat([a]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},a=0;a<this.length;a++){var i=this[a][0];"number"==typeof i&&(r[i]=!0)}for(a=0;a<e.length;a++){var o=e[a];"number"==typeof o[0]&&r[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),t.push(o))}},t}},function(e,t,n){(e.exports=n(3)(!1)).push([e.i,':host{box-sizing:border-box;line-height:var(--now-line-height,1.25);font-family:var(--now-font-family,"Source Sans Pro",sans-serif)}:host([hidden]){display:none}#container,*,:after,:before{box-sizing:border-box}#container{position:relative;align-items:center;justify-content:center}#container div{position:absolute}.countdown #canvas,.idle #canvas,.idle #counter,.preview #counter,.preview #video,.snapping #counter,.snapping #video{display:none}',""])},function(e,t,n){var r=n(4);e.exports="string"==typeof r?r:r.toString()},function(e,t){e.exports=__TECTONIC__$servicenow_ui_core},function(e,t,n){"use strict";var r,a=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&c.return&&c.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=(n(0),n(0)),o=l(i),c=n(6),u=l(n(5)),d=n(2),s=n(1);function l(e){return e&&e.__esModule?e:{default:e}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=c.actionTypes.COMPONENT_CONNECTED,v=c.actionTypes.COMPONENT_PROPERTY_CHANGED,m=function(e){var t=e.video,n=e.cameraDeviceId,r=e.enabled,a=e.updateState,i=e.dispatch;console.log("SWITCH MEDIA DEVICE","Device ID:",n,"Enabled?",r),navigator.mediaDevices.getUserMedia({video:{deviceId:n}}).then(function(e){console.log("Got User Media!",t,n),t.srcObject&&t.srcObject.getTracks().forEach(function(e){e.stop()}),t.srcObject=e,h({video:t,enabled:r}),t.play(),a({stream:e}),function(e){var t=e.cameraDeviceId,n=e.dispatch;console.log("DISPATCH CONNECTED DEVICES"),(0,s.getConnectedDevices)("videoinput",function(e){e.forEach(function(e){return e.id=e.deviceId});var r={selectedCameraDeviceId:t,cameras:e,selectedDeviceIdFound:!1,boundCameraDeviceId:null};if(1==e.filter(function(e){return e.deviceId===t}).length)r.selectedDeviceIdFound=!0,r.boundCameraDeviceId=t;else if(1===e.length){var a=e[0].deviceId;r.selectedDeviceIdFound=a===t,r.boundCameraDeviceId=a}n("PHOTOBOOTH_CAMERA#AVAILABLE_CAMERAS_UPDATED",r)})}({cameraDeviceId:n,dispatch:i})}).catch(function(e){throw console.log("Error Getting Media!",e),e})},h=function(e){var t=e.video.srcObject,n=e.enabled;t&&t.getTracks().forEach(function(e){return e.enabled=n})},g=(f(r={},c.actionTypes.COMPONENT_DOM_READY,function(e){var t=e.host,n=e.state.properties,r=n.enabled,a=n.watermarkImageUrl,i=n.watermarkImageScale,o=n.cameraDeviceId,c=e.updateState,u=e.dispatch;e.video;console.log("COMPONENT_DOM_READY"),function(e){var t=e.host,n=e.enabled,r=e.updateState,a=e.cameraDeviceId,i=e.dispatch;console.log("INITIALIZE MEDIA!");var o=t.shadowRoot.getElementById("video"),c=t.shadowRoot.getElementById("canvas");r({video:o,context:c.getContext("2d"),canvas:c,counter:t.shadowRoot.getElementById("counter")}),m({video:o,cameraDeviceId:a,enabled:n,updateState:r,dispatch:i})}({host:t,enabled:r,updateState:c,cameraDeviceId:o,dispatch:u}),function(e){var t=e.watermarkImageUrl,n=e.watermarkImageScale,r=e.updateState;if(console.log("Initialize Watermark",t),t){var a=new Image;a.onload=function(e){var t=e.target,i=t.width,o=t.height;a.width=i*n,a.height=o*n,r({watermarkImage:a})},a.src=t}}({watermarkImageUrl:a,watermarkImageScale:i,updateState:c})}),f(r,p,function(e){!function(e){if(null==e)throw new TypeError("Cannot destructure undefined")}(e)}),f(r,v,function(e){var t=e.state,n=e.action.payload,r=n.name,a=n.value,i=n.previousValue,o=e.dispatch,c=e.updateState;console.log(v,r,a);var u=t.snapState,d=t.video,s=t.properties.enabled,l={snapRequested:function(){if(a&&a!=i)y(t,o,c);else a||"idle"==u||c({snapState:"idle"})},enabled:function(){h({video:d,enabled:a}),c({snapState:"idle"})},cameraDeviceId:function(){var e=a;m({video:d,cameraDeviceId:e,enabled:s,updateState:c,dispatch:o}),c({cameraDeviceId:e})}};l[r]&&l[r]()}),r),b=function(e,t,n){var r=n.context,i=n.video,o=n.watermarkImage,c=n.properties,u=c.imageSize,s=u.width,l=u.height,f=c.watermarkImagePosition,p=s/2,v=l/2;if(r.drawImage(i,e,t,p,v),o){var m=(0,d.getCoordinates)(f,o.width,o.height,p,v,[e,t]),h=a(m,2),g=h[0],b=h[1];r.drawImage(o,g,b,o.width/2,o.height/2)}},y=function(e,t,n){var r=e.context,a=e.canvas,i=e.properties,o=i.countdownDurationSeconds,c=i.imageSize,u=c.width,d=c.height,s=0;o>0&&n({snapState:"countdown"});var l=u/2,f=d/2;r.clearRect(0,0,u,d);setTimeout(function r(){switch(s){case 0:n({snapState:"snapping"}),b(0,0,e),s=1;break;case 1:b(l,0,e),s=2;break;case 2:b(0,f,e),s=3;break;case 3:b(l,f,e),s=0}if(0!=s)setTimeout(r,500);else{n({snapState:"preview"});var i=a.toDataURL("image/jpeg");t("PHOTOBOOTH_CAMERA#SNAPPED",{imageData:i})}},1e3*o)};(0,c.createCustomElement)("snc-photobooth-uic-camera",{renderer:{type:o.default},view:function(e){var t=e.snapState,n=e.properties,r=n.imageSize,a=r.width,o=r.height,c=n.countdownAnimationCss;e.updateState;return(0,i.createElement)("div",null,(0,i.createElement)("style",null,c),(0,i.createElement)("div",{id:"container",className:t,style:{width:a+"px",height:o+"px"}},(0,i.createElement)("div",{id:"content"},(0,i.createElement)("video",{id:"video",width:a,height:o,autoplay:""}),(0,i.createElement)("canvas",{id:"canvas",width:a,height:o})),(0,i.createElement)("div",{id:"counter"})))},styles:u.default,initialState:{snapState:"idle",watermarkImage:null},actionHandlers:g,dispatches:{PHOTOBOOTH_CAMERA_SNAPPED:{},PHOTOBOOTH_AVAILABLE_CAMERAS_UPDATED:{}},properties:{enabled:{schema:{type:"boolean"},default:!1},snapRequested:{default:"",schema:{type:"string"}},countdownDurationSeconds:{default:0,schema:{type:"number"}},imageSize:{default:{width:640,height:480},schema:{type:"object",properties:{width:{type:"integer"},height:{type:"integer"}},required:["width","height"]}},cameraDeviceId:{default:"",schema:{type:"string"}},countdownAnimationCss:{schema:{type:"string"},default:""},watermarkImageUrl:{schema:{type:"string"},default:""},watermarkImagePosition:{schema:{type:"string",enum:["top-left","top-center","top-right","bottom-left","bottom-center","bottom-right","center"]},default:"center"},watermarkImageScale:{schema:{type:"number"},default:1}}})},function(e,t,n){"use strict";n(7)},function(e,t,n){e.exports=n(8)}]);]]></script>
        <script_link/>
        <sys_class_name>sys_ux_lib_source_script</sys_class_name>
        <sys_created_by>jon.lind</sys_created_by>
        <sys_created_on>2022-09-26 21:38:20</sys_created_on>
        <sys_id>6f69abc99a2e1277aa55dd9a07909e8d</sys_id>
        <sys_name>@snc/photobooth-uic-camera</sys_name>
        <sys_package display_value="Photobooth UIC Camera" source="x_snc_pb_camera">fe8710bf47ce9d10552caf52736d432a</sys_package>
        <sys_policy/>
        <sys_scope display_value="Photobooth UIC Camera">fe8710bf47ce9d10552caf52736d432a</sys_scope>
        <sys_update_name>sys_ux_lib_source_script_6f69abc99a2e1277aa55dd9a07909e8d</sys_update_name>
        <type>script</type>
    </sys_ux_lib_source_script>
</record_update>
