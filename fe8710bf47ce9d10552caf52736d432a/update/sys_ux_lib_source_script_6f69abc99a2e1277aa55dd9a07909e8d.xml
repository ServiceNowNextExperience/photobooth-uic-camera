<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ux_lib_source_script">
    <sys_ux_lib_source_script action="INSERT_OR_UPDATE">
        <config_option/>
        <engine>6</engine>
        <externals/>
        <inner_components/>
        <name>@snc/photobooth-uic-camera</name>
        <script><![CDATA[var __TECTONIC__$snc_photobooth_uic_camera=function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=11)}([function(e,t){e.exports=__TECTONIC__$servicenow_ui_renderer_snabbdom},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PHOTOBOOTH_CAMERA_SNAPPED="PHOTOBOOTH_CAMERA#SNAPPED",t.PHOTOBOOTH_AVAILABLE_CAMERAS_UPDATED="PHOTOBOOTH_CAMERA#AVAILABLE_CAMERAS_UPDATED",t.PHOTOBOOTH_CAMERA_SINGLE_SNAPPED="PHOTOBOOH_CAMERA#SINGLE_SNAPPED"},function(e,t,n){"use strict";function a(e){var t=e.video.srcObject,n=e.enabled;t&&t.getTracks().forEach(function(e){return e.enabled=n})}function i(e){var t=e.pos,n=e.context,a=e.video,i=e.gap,o=void 0===i?10:i,r=e.chin,c=void 0===r?0:r,s=n.canvas,u=s.width/2-3*o/2,d=(s.height-c)/2-3*o/2,l={1:{x:o,y:o},2:{x:u+2*o,y:o},3:{x:o,y:d+2*o},4:{x:u+2*o,y:d+2*o}}[t],f=l.x,p=l.y;n.drawImage(a,f,p,u,d)}Object.defineProperty(t,"__esModule",{value:!0}),t.selectMediaDevice=function(e){var t=e.video,n=e.cameraDeviceId,i=void 0===n?"":n,o=e.enabled;return console.log("SELECT MEDIA DEVICE",{cameraDeviceId:i,enabled:o}),new Promise(function(e,n){navigator.mediaDevices.getUserMedia({video:{deviceId:i}}).then(function(n){console.log("Got User Media!",{video:t,cameraDeviceId:i}),t.srcObject&&t.srcObject.getTracks().forEach(function(e){e.stop()}),t.srcObject=n,a({video:t,enabled:o}),t.play(),e()}).catch(function(e){console.log("Error Getting Media!",e),n({exc:e})})})},t.toggleTracks=a,t.getConnectedDevices=function(e){var t=e.deviceType,n=void 0===t?"videoinput":t,a=e.cameraDeviceId;return new Promise(function(e){navigator.mediaDevices.enumerateDevices().then(function(t){var i=t.filter(function(e){return e.kind===n});i.forEach(function(e){return e.id=e.deviceId});var o={selectedCameraDeviceId:a,cameras:i,selectedDeviceIdFound:!1,boundCameraDeviceId:null};if(1==i.filter(function(e){return e.deviceId===a}).length)o.selectedDeviceIdFound=!0,o.boundCameraDeviceId=a;else if(1===i.length){var r=i[0].deviceId;o.selectedDeviceIdFound=r===a,o.boundCameraDeviceId=r}e(o)})})},t.initializeCanvas=function(e){var t=e.context,n=e.imageSize,a=void 0===n?{width:800,height:600}:n,i=e.fillStyle,o=t.canvas;console.log("Initialize Canvas",o,a,i),o.width=a.width,o.height=a.height,t.fillStyle=i,t.fillRect(0,0,o.width,o.height)},t.drawImage=i,t.snap=function(e){var t=e.state,n=e.updateState,a=e.onIndividualSnap,o=t.video,r=t.context,c=t.shutterSound,s=t.properties,u=s.countdownDurationSeconds,d=s.pauseDurationSeconds,l=void 0===d?1:d,f=s.pauseDurationMilliseconds,p=void 0===f?1e3*l:f,m=s.gap,v=s.chin,g=1;u>0&&n({snapState:"countdown"});return new Promise(function(e){setTimeout(function t(){console.log("_snap",g,r),n({snapState:"snapping"}),i({pos:g,context:r,video:o,gap:m,chin:v}),c&&c.play();if(a){var s=r.canvas.toDataURL("image/jpeg");a({imageData:s})}g<4?(g++,setTimeout(t,p)):(n({snapState:"preview"}),e({context:r}))},1e3*u)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var r,c=e[Symbol.iterator]();!(a=(r=c.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{!a&&c.return&&c.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.initializeWatermark=function(e){var t=e.watermarkImageUrl,n=e.watermarkImageScale;return console.log("Initialize Watermark",t),new Promise(function(e){if(t){var a=new Image;a.onload=function(t){var i=t.target,o=i.width,r=i.height;a.width=o*n,a.height=r*n,e({watermarkImage:a})},a.src=t}else e(null)})};t.applyWatermark=function(e){var t=e.watermarkImage,n=e.context,o=e.watermarkImagePosition,r=e.gap;if(console.log("applyWatermark",t),t){var c=i({watermarkImagePosition:o,imageWidth:t.width,imageHeight:t.height,canvas:n.canvas,gap:r}),s=a(c,2),u=s[0],d=s[1];n.drawImage(t,u,d,t.width,t.height)}};var i=function(e){var t=e.watermarkImagePosition,n=e.imageWidth,a=e.imageHeight,i=e.canvas,o=i.width,r=i.height,c=e.gap,s=void 0===c?10:c,u=s,d=s,l=o/2-n/2,f=r/2-a/2,p=0+u,m=0+d,v=o-n-u,g=r-a-d;switch(console.log({watermarkImagePosition:t,imageWidth:n,imageHeight:a,canvasWidth:o,canvasHeight:r,offsetX:u,offsetY:d,xRight:v}),t){case"top-left":return[p,m];case"top-center":return[l,m];case"top-right":return[v,m];case"bottom-left":return[p,g];case"bottom-center":return[l,g];case"bottom-right":return[v,g];case"center":return[l,f];default:return[0+s,0+s]}};t.getCoordinates=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.properties={enabled:{schema:{type:"boolean"},default:!1},snapRequested:{default:"",schema:{type:"string"}},countdownDurationSeconds:{default:0,schema:{type:"number"}},pauseDurationSeconds:{default:1,schema:{type:"number"}},imageSize:{default:{width:800,height:600},schema:{type:"object",properties:{width:{type:"integer"},height:{type:"integer"}},required:["width","height"]}},gap:{default:10,schema:{type:"number"}},chin:{default:50,schema:{type:"number"}},fillStyle:{default:"lightgreen",schema:{type:"string"}},cameraDeviceId:{default:"",schema:{type:"string"}},countdownAnimationCss:{schema:{type:"string"},default:""},watermarkImageUrl:{schema:{type:"string"},default:""},watermarkImagePosition:{schema:{type:"string",enum:["top-left","top-center","top-right","bottom-left","bottom-center","bottom-right","center"]},default:"center"},watermarkImageScale:{schema:{type:"number"},default:1},shutterSoundFile:{schema:{type:"string"},default:""}}},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n=e[1]||"",a=e[3];if(!a)return n;if(t&&"function"==typeof btoa){var i=function(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}(a),o=a.sources.map(function(e){return"/*# sourceURL="+a.sourceRoot+e+" */"});return[n].concat(o).concat([i]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var a={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(a[o]=!0)}for(i=0;i<e.length;i++){var r=e[i];"number"==typeof r[0]&&a[r[0]]||(n&&!r[2]?r[2]=n:n&&(r[2]="("+r[2]+") and ("+n+")"),t.push(r))}},t}},function(e,t,n){(e.exports=n(5)(!1)).push([e.i,':host{box-sizing:border-box;line-height:var(--now-line-height,1.25);font-family:var(--now-font-family,"Source Sans Pro",sans-serif)}:host([hidden]){display:none}*,:after,:before{box-sizing:border-box}@keyframes flasher{0%{background-color:#fff}25%{background-color:#fff}to{background-color:none}}#flash{position:absolute;width:100%;height:100%;top:0;left:0;z-index:1000}.snapping #flash{display:default;animation:flasher}#container{position:relative;align-items:center;justify-content:center;box-sizing:border-box}#container div{position:absolute}.countdown #counter,.countdown #flash,.idle #counter,.idle #flash{display:none}.snapping #counter,.snapping #flash{display:default}.preview #counter{display:none}',""])},function(e,t,n){var a=n(6);e.exports="string"==typeof a?a:a.toString()},function(e,t){e.exports=__TECTONIC__$servicenow_ui_core},function(e,t,n){"use strict";var a,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o=(n(0),n(0)),r=p(o),c=n(8),s=p(n(7)),u=n(4),d=n(3),l=n(2),f=n(1);function p(e){return e&&e.__esModule?e:{default:e}}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=c.actionTypes.COMPONENT_CONNECTED,g=c.actionTypes.COMPONENT_PROPERTY_CHANGED,h=c.actionTypes.COMPONENT_DOM_READY,O=(m(a={},h,function(e){var t=e.host,n=e.state.properties,a=e.updateState,o=e.dispatch;console.log(h,t,n),function(e){var t=e.host,n=e.updateState,a=e.dispatch,o=e.properties;console.log("INITIALIZE MEDIA!");var r=o.enabled,c=o.cameraDeviceId,s=o.shutterSoundFile,u=t.shadowRoot.getElementById("video"),p=t.shadowRoot.ownerDocument.createElement("canvas").getContext("2d"),m=new Audio(s);(0,l.initializeCanvas)(i({context:p},o)),(0,d.initializeWatermark)(o).then(n),(0,l.selectMediaDevice)({video:u,cameraDeviceId:c,enabled:r}),(0,l.getConnectedDevices)({cameraDeviceId:c}).then(function(e){console.log(f.PHOTOBOOTH_AVAILABLE_CAMERAS_UPDATED,e),a(f.PHOTOBOOTH_AVAILABLE_CAMERAS_UPDATED,e)}),n({video:u,context:p,shutterSound:m})}({host:t,properties:n,dispatch:o,updateState:a})}),m(a,v,function(e){var t=e.properties;console.log(v,t)}),m(a,g,function(e){var t=e.state,n=e.action.payload,a=n.name,i=n.value,o=n.previousValue,r=e.dispatch,c=e.updateState;console.log(g,{name:a,value:i});var s=t.snapState,u=t.video,p=t.watermarkImage,m=t.properties,v=m.enabled,h=m.watermarkImagePosition,O=m.gap,y={snapRequested:function(){if(i&&i!=o){(0,l.snap)({state:t,updateState:c,onIndividualSnap:function(e){var t=e.imageData;console.log(f.PHOTOBOOTH_CAMERA_SINGLE_SNAPPED,{imageData:t}),r(f.PHOTOBOOTH_CAMERA_SINGLE_SNAPPED,{imageData:t})}}).then(function(e){var t=e.context;console.log("SNAP COMPLETED",t),(0,d.applyWatermark)({context:t,watermarkImage:p,watermarkImagePosition:h,gap:O});var n=t.canvas.toDataURL("image/jpeg");r(f.PHOTOBOOTH_CAMERA_SNAPPED,{imageData:n})})}else i||"idle"==s||c({snapState:"idle"})},enabled:function(){(0,l.toggleTracks)({video:u,enabled:i}),c({snapState:"idle"})},cameraDeviceId:function(){var e=i;(0,l.selectMediaDevice)({video:u,cameraDeviceId:e,enabled:v}),c({cameraDeviceId:e})}};y[a]&&y[a]()}),a);(0,c.createCustomElement)("snc-photobooth-uic-camera",{renderer:{type:r.default},view:function(e){var t=e.snapState,n=e.properties,a=n.countdownAnimationCss,i=n.pauseDurationSeconds,r=n.animationDuration,c=void 0===r?i+"s":r;return(0,o.createElement)("div",null,(0,o.createElement)("style",null,a),(0,o.createElement)("div",{id:"container",className:t},(0,o.createElement)("div",{id:"flash",style:{"animation-iteration-count":4,"animation-duration":c}}),(0,o.createElement)("video",{id:"video",autoplay:"",style:{width:"100%"}})))},styles:s.default,initialState:{snapState:"idle",watermarkImage:null},actionHandlers:O,dispatches:{PHOTOBOOTH_CAMERA_SNAPPED:{},PHOTOBOOTH_AVAILABLE_CAMERAS_UPDATED:{}},properties:u.properties})},function(e,t,n){"use strict";n(9)},function(e,t,n){e.exports=n(10)}]);]]></script>
        <script_link/>
        <sys_class_name>sys_ux_lib_source_script</sys_class_name>
        <sys_created_by>jon.lind</sys_created_by>
        <sys_created_on>2022-09-26 21:38:20</sys_created_on>
        <sys_id>6f69abc99a2e1277aa55dd9a07909e8d</sys_id>
        <sys_mod_count>466056</sys_mod_count>
        <sys_name>@snc/photobooth-uic-camera</sys_name>
        <sys_package display_value="Photobooth UIC Camera" source="x_snc_pb_camera">fe8710bf47ce9d10552caf52736d432a</sys_package>
        <sys_policy/>
        <sys_scope display_value="Photobooth UIC Camera">fe8710bf47ce9d10552caf52736d432a</sys_scope>
        <sys_update_name>sys_ux_lib_source_script_6f69abc99a2e1277aa55dd9a07909e8d</sys_update_name>
        <sys_updated_by>jon.lind</sys_updated_by>
        <sys_updated_on>2023-03-02 23:22:49</sys_updated_on>
        <type>script</type>
    </sys_ux_lib_source_script>
</record_update>
