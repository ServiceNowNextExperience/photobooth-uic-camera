<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ux_lib_source_script">
    <sys_ux_lib_source_script action="INSERT_OR_UPDATE">
        <config_option/>
        <engine>6</engine>
        <externals/>
        <inner_components/>
        <name>@snc/photobooth-uic-camera</name>
        <script><![CDATA[var __TECTONIC__$snc_photobooth_uic_camera=function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=10)}([function(e,t){e.exports=__TECTONIC__$servicenow_ui_renderer_snabbdom},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getConnectedDevices=function(e,t){navigator.mediaDevices.enumerateDevices().then(function(a){var n=a.filter(function(t){return t.kind===e});t(n)})}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],n=!0,r=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(n=(o=c.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){r=!0,i=e}finally{try{!n&&c.return&&c.return()}finally{if(r)throw i}}return a}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.initializeWatermark=function(e){var t=e.watermarkImageUrl,a=e.watermarkImageScale,n=e.onload,r=void 0===n?function(){}:n;if(console.log("Initialize Watermark",t),t){var i=new Image;i.onload=function(e){var t=e.target,n=t.width,o=t.height;i.width=n*a,i.height=o*a,r({watermarkImage:i})},i.src=t}};t.applyWatermark=function(e){var t=e.watermarkImage,a=e.context,i=e.canvas,o=e.properties,c=o.watermarkImagePosition,s=o.gap;if(console.log("applyWatermark",t),t){var u=r({watermarkImagePosition:c,imageWidth:t.width,imageHeight:t.height,canvas:i,gap:s}),d=n(u,2),l=d[0],p=d[1];a.drawImage(t,l,p,t.width,t.height)}};var r=function(e){var t=e.watermarkImagePosition,a=e.imageWidth,n=e.imageHeight,r=e.canvas,i=r.width,o=r.height,c=e.gap,s=void 0===c?0:c,u=s,d=s,l=i/2-a/2,p=o/2-n/2,f=0+u,m=0+d,h=i-a-u,g=o-n-d;switch(console.log({watermarkImagePosition:t,imageWidth:a,imageHeight:n,canvasWidth:i,canvasHeight:o,offsetX:u,offsetY:d,xRight:h}),t){case"top-left":return[f,m];case"top-center":return[l,m];case"top-right":return[h,m];case"bottom-left":return[f,g];case"bottom-center":return[l,g];case"bottom-right":return[h,g];case"center":return[l,p];default:return[0+s,0+s]}};t.getCoordinates=r},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.properties={enabled:{schema:{type:"boolean"},default:!1},snapRequested:{default:"",schema:{type:"string"}},countdownDurationSeconds:{default:0,schema:{type:"number"}},pauseDurationSeconds:{default:1,schema:{type:"number"}},imageSize:{default:{width:800,height:600},schema:{type:"object",properties:{width:{type:"integer"},height:{type:"integer"}},required:["width","height"]}},gap:{default:10,schema:{type:"number"}},chin:{default:50,schema:{type:"number"}},fillStyle:{default:"lightgreen",schema:{type:"string"}},cameraDeviceId:{default:"",schema:{type:"string"}},countdownAnimationCss:{schema:{type:"string"},default:""},watermarkImageUrl:{schema:{type:"string"},default:""},watermarkImagePosition:{schema:{type:"string",enum:["top-left","top-center","top-right","bottom-left","bottom-center","bottom-right","center"]},default:"center"},watermarkImageScale:{schema:{type:"number"},default:1}}},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var a=function(e,t){var a=e[1]||"",n=e[3];if(!n)return a;if(t&&"function"==typeof btoa){var r=function(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}(n),i=n.sources.map(function(e){return"/*# sourceURL="+n.sourceRoot+e+" */"});return[a].concat(i).concat([r]).join("\n")}return[a].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+a+"}":a}).join("")},t.i=function(e,a){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},r=0;r<this.length;r++){var i=this[r][0];"number"==typeof i&&(n[i]=!0)}for(r=0;r<e.length;r++){var o=e[r];"number"==typeof o[0]&&n[o[0]]||(a&&!o[2]?o[2]=a:a&&(o[2]="("+o[2]+") and ("+a+")"),t.push(o))}},t}},function(e,t,a){(e.exports=a(4)(!1)).push([e.i,':host{box-sizing:border-box;line-height:var(--now-line-height,1.25);font-family:var(--now-font-family,"Source Sans Pro",sans-serif)}:host([hidden]){display:none}*,:after,:before{box-sizing:border-box}@keyframes flasher{0%{background-color:#fff}25%{background-color:#fff}to{background-color:none}}#flash{position:absolute;width:100%;height:100%;top:0;left:0;z-index:1000}.snapping #flash{display:default;animation:flasher}#container{position:relative;align-items:center;justify-content:center;box-sizing:border-box}#container div{position:absolute}.idle #counter,.idle #flash{display:none}.countdown #counter,.countdown #flash{display:none}.snapping #counter,.snapping #flash{display:default}.preview #counter{display:none}',""])},function(e,t,a){var n=a(5);e.exports="string"==typeof n?n:n.toString()},function(e,t){e.exports=__TECTONIC__$servicenow_ui_core},function(e,t,a){"use strict";a(0);var n,r=a(0),i=l(r),o=a(7),c=l(a(6)),s=a(3),u=a(2),d=a(1);function l(e){return e&&e.__esModule?e:{default:e}}function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var f=o.actionTypes.COMPONENT_CONNECTED,m=o.actionTypes.COMPONENT_PROPERTY_CHANGED,h=function(e){var t=e.video,a=e.cameraDeviceId,n=e.enabled,r=e.updateState,i=e.dispatch;console.log("SWITCH MEDIA DEVICE",{cameraDeviceId:a,enabled:n}),navigator.mediaDevices.getUserMedia({video:{deviceId:a}}).then(function(e){console.log("Got User Media!",{video:t,cameraDeviceId:a}),t.srcObject&&t.srcObject.getTracks().forEach(function(e){e.stop()}),t.srcObject=e,g({video:t,enabled:n}),t.play(),r({stream:e}),function(e){var t=e.cameraDeviceId,a=e.dispatch;(0,d.getConnectedDevices)("videoinput",function(e){e.forEach(function(e){return e.id=e.deviceId});var n={selectedCameraDeviceId:t,cameras:e,selectedDeviceIdFound:!1,boundCameraDeviceId:null};if(1==e.filter(function(e){return e.deviceId===t}).length)n.selectedDeviceIdFound=!0,n.boundCameraDeviceId=t;else if(1===e.length){var r=e[0].deviceId;n.selectedDeviceIdFound=r===t,n.boundCameraDeviceId=r}console.log("PHOTOBOOTH_CAMERA#AVAILABLE_CAMERAS_UPDATED",n),a("PHOTOBOOTH_CAMERA#AVAILABLE_CAMERAS_UPDATED",n)})}({cameraDeviceId:a,dispatch:i})}).catch(function(e){throw console.log("Error Getting Media!",e),e})},g=function(e){var t=e.video.srcObject,a=e.enabled;t&&t.getTracks().forEach(function(e){return e.enabled=a})},v=(p(n={},o.actionTypes.COMPONENT_DOM_READY,function(e){var t=e.host,a=e.state.properties,n=e.updateState;!function(e){var t=e.host,a=e.updateState,n=e.dispatch,r=e.properties,i=r.enabled,o=r.cameraDeviceId,c=r.imageSize,s=r.watermarkImageUrl,d=r.watermarkImageScale,l=r.watermarkImagePosition,p=r.gap,f=r.chin,m=r.fillStyle;console.log("INITIALIZE MEDIA!");var g=t.shadowRoot.getElementById("video"),v=t.shadowRoot.ownerDocument.createElement("canvas");v.width=c.width+3*p,v.height=c.height+3*p+f;var b=v.getContext("2d");b.fillStyle=m,b.fillRect(0,0,v.width,v.height),s&&(0,u.initializeWatermark)({watermarkImageUrl:s,watermarkImageScale:d,watermarkImagePosition:l,gap:p,canvas:v,context:b,onload:a}),a({video:g,context:b,canvas:v}),h({video:g,cameraDeviceId:o,enabled:i,updateState:a,dispatch:n})}({host:t,properties:a,dispatch:e.dispatch,updateState:n})}),p(n,f,function(e){!function(e){if(null==e)throw new TypeError("Cannot destructure undefined")}(e)}),p(n,m,function(e){var t=e.state,a=e.action.payload,n=a.name,r=a.value,i=a.previousValue,o=e.dispatch,c=e.updateState;console.log(m,{name:n,value:r});var s=t.snapState,u=t.video,d=t.properties.enabled,l={snapRequested:function(){if(r&&r!=i)b({state:t,dispatch:o,updateState:c});else r||"idle"==s||c({snapState:"idle"})},enabled:function(){g({video:u,enabled:r}),c({snapState:"idle"})},cameraDeviceId:function(){var e=r;h({video:u,cameraDeviceId:e,enabled:d,updateState:c,dispatch:o}),c({cameraDeviceId:e})}};l[n]&&l[n]()}),n),b=function(e){var t=e.state,a=e.dispatch,n=e.updateState,r=t.canvas,i=t.properties,o=i.countdownDurationSeconds,c=i.pauseDurationSeconds,s=i.pauseDurationMilliseconds,d=void 0===s?1e3*c:s,l=1;o>0&&n({snapState:"countdown"});setTimeout(function e(){if(console.log("_snap",l),n({snapState:"snapping"}),function(e,t){var a=t.context,n=t.video,r=t.properties,i=r.imageSize,o=i.width,c=i.height,s=r.gap,u=o/2,d=c/2,l={1:{x:s,y:s},2:{x:u+2*s,y:s},3:{x:s,y:d+2*s},4:{x:u+2*s,y:d+2*s}}[e],p=l.x,f=l.y;a.drawImage(n,p,f,u,d)}(l,t),l<4)l++,setTimeout(e,d);else{n({snapState:"preview"}),(0,u.applyWatermark)(t);var i=r.toDataURL("image/jpeg");a("PHOTOBOOTH_CAMERA#SNAPPED",{imageData:i})}},1e3*o)};(0,o.createCustomElement)("snc-photobooth-uic-camera",{renderer:{type:i.default},view:function(e){var t=e.snapState,a=e.properties,n=a.countdownAnimationCss,i=a.pauseDurationSeconds,o=a.animationDuration,c=void 0===o?i+"s":o;return(0,r.createElement)("div",null,(0,r.createElement)("style",null,n),(0,r.createElement)("div",{id:"container",className:t},(0,r.createElement)("div",{id:"flash",style:{"animation-iteration-count":4,"animation-duration":c}}),(0,r.createElement)("video",{id:"video",autoplay:"",style:{width:"100%"}})))},styles:c.default,initialState:{snapState:"idle",watermarkImage:null},actionHandlers:v,dispatches:{PHOTOBOOTH_CAMERA_SNAPPED:{},PHOTOBOOTH_AVAILABLE_CAMERAS_UPDATED:{}},properties:s.properties})},function(e,t,a){"use strict";a(8)},function(e,t,a){e.exports=a(9)}]);]]></script>
        <script_link/>
        <sys_class_name>sys_ux_lib_source_script</sys_class_name>
        <sys_created_by>jon.lind</sys_created_by>
        <sys_created_on>2022-09-26 21:38:20</sys_created_on>
        <sys_id>6f69abc99a2e1277aa55dd9a07909e8d</sys_id>
        <sys_mod_count>465504</sys_mod_count>
        <sys_name>@snc/photobooth-uic-camera</sys_name>
        <sys_package display_value="Photobooth UIC Camera" source="x_snc_pb_camera">fe8710bf47ce9d10552caf52736d432a</sys_package>
        <sys_policy/>
        <sys_scope display_value="Photobooth UIC Camera">fe8710bf47ce9d10552caf52736d432a</sys_scope>
        <sys_update_name>sys_ux_lib_source_script_6f69abc99a2e1277aa55dd9a07909e8d</sys_update_name>
        <sys_updated_by>jon.lind</sys_updated_by>
        <sys_updated_on>2023-02-07 23:51:11</sys_updated_on>
        <type>script</type>
    </sys_ux_lib_source_script>
</record_update>
