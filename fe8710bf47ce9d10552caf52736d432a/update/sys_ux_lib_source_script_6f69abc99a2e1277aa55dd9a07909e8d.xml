<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ux_lib_source_script">
    <sys_ux_lib_source_script action="INSERT_OR_UPDATE">
        <config_option/>
        <engine>6</engine>
        <externals/>
        <inner_components/>
        <name>@snc/photobooth-uic-camera</name>
        <script><![CDATA[var __TECTONIC__$snc_photobooth_uic_camera=function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=12)}([function(e,t){e.exports=__TECTONIC__$servicenow_ui_renderer_snabbdom},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PHOTOBOOTH_CAMERA_SNAPPED="PHOTOBOOTH_CAMERA#SNAPPED",t.PHOTOBOOTH_AVAILABLE_CAMERAS_UPDATED="PHOTOBOOTH_CAMERA#AVAILABLE_CAMERAS_UPDATED",t.PHOTOBOOTH_CAMERA_SINGLES_SNAPPED="PHOTOBOOTH_CAMERA#SINGLES_SNAPPED",t.PHOTOBOOTH_CAMERA_DOUBLE_CLICK="PHOTOBOOTH_CAMERA#DBLCLICK"},function(e,t,a){"use strict";function n(e){var t=e.video.srcObject,a=e.enabled;!t||!0!==a&&!1!==a||t.getTracks().forEach(function(e){return e.enabled=a})}function r(e,t){var a=t.imageSize,n=a.width,r=a.height,o=t.fillStyle,i=void 0===o?null:o;e.canvas.width=n,e.canvas.height=r,e.fillStyle=i||e.fillStyle,e.fillRect(0,0,n,r)}function o(e,t,a){var n=a.x,r=void 0===n?0:n,o=a.y,i=void 0===o?0:o,c=a.width,s=a.height;e.drawImage(t,r,i,c,s)}Object.defineProperty(t,"__esModule",{value:!0}),t.selectMediaDevice=function(e){var t=e.video,a=e.cameraDeviceId,r=void 0===a?"":a,o=e.enabled;return console.log("SELECT MEDIA DEVICE",{cameraDeviceId:r,enabled:o}),new Promise(function(e,a){navigator.mediaDevices.getUserMedia({video:{deviceId:r}}).then(function(a){console.log("Got User Media!",{video:t,cameraDeviceId:r,stream:a}),t.srcObject&&t.srcObject.getTracks().forEach(function(e){e.stop()}),t.srcObject=a,n({video:t,enabled:o}),t.play(),e(a)}).catch(function(e){console.log("Error Getting Media!",e),a({exc:e})})})},t.toggleTracks=n,t.getConnectedDevices=function(e){var t=e.deviceType,a=void 0===t?"videoinput":t,n=e.cameraDeviceId;return new Promise(function(e){navigator.mediaDevices.enumerateDevices().then(function(t){var r=t.filter(function(e){return e.kind===a});r.forEach(function(e){return e.id=e.deviceId});var o={selectedCameraDeviceId:n,cameras:r,selectedDeviceIdFound:!1,boundCameraDeviceId:null};if(1==r.filter(function(e){return e.deviceId===n}).length)o.selectedDeviceIdFound=!0,o.boundCameraDeviceId=n;else if(1===r.length){var i=r[0].deviceId;o.selectedDeviceIdFound=i===n,o.boundCameraDeviceId=i}e(o)})})},t.snap=function(e){var t=e.state,a=e.updateState,n=t.video,i=t.context,c=t.shutterSound,s=t.properties,u=s.countdownDurationSeconds,l=s.pauseDurationSeconds,d=void 0===l?1:l,p=s.pauseDurationMilliseconds,f=void 0===p?1e3*d:p,m=s.gap,h=void 0===m?10:m,v=s.chin,g=void 0===v?0:v,O=s.imageSize,b=void 0===O?{width:800,height:600}:O,_=s.fillStyle,y=[],E=1,A={width:b.width+3*h,height:b.height+3*h+g};r(i,{imageSize:A,fillStyle:_}),u>0&&a({snapState:"countdown"});for(var S=0;S<4;S++){var w=i.canvas.ownerDocument.createElement("canvas").getContext("2d");r(w,{imageSize:b}),y.push(w)}return new Promise(function(e){setTimeout(function t(){console.log("_snap",E,i),a({snapState:"snapping"}),c&&(console.log("SHUTTER SOUND!"),c.play());(function(e){var t=e.pos,a=e.context,n=e.video,r=e.gap,i=e.chin;console.log("drawToSnapImage",{context:a});var c=a.canvas,s=c.width,u=c.height,l=(s-3*r)/2,d=(u-3*r-i)/2,p={1:{x:r,y:r},2:{x:l+2*r,y:r},3:{x:r,y:d+2*r},4:{x:l+2*r,y:d+2*r}}[t],f=p.x,m=p.y;o(a,n,{x:f,y:m,width:l,height:d})})({pos:E,context:i,video:n,gap:h,chin:g}),o(y[E-1],n,b),E<4?(E++,setTimeout(t,f)):(a({snapState:"idle"}),e({context:i,singleSnapContexts:y}))},1e3*u)})}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setupAppMetadata=function(e){var t=e.document,a=t.getElementsByTagName("head")[0];function n(e,a,n){var r=t.createElement("link");return e&&r.setAttribute("rel",e),a&&r.setAttribute("href",a),n&&r.setAttribute("sizes",n),r}function r(e,a){var n=t.createElement("meta");return n.setAttribute("name",e),n.setAttribute("content",a),n}a.appendChild(r("apple-mobile-web-app-capable","yes")),a.appendChild(r("apple-mobile-web-app-status-bar-style","black")),a.appendChild(r("apple-mobile-web-app-title","Photobooth")),a.appendChild(n("apple-touch-icon","x_snc_pb_app.photobooth_touch_icon_180.png")),a.appendChild(n("apple-touch-startup-image","x_snc_pb_app.photobooth_launch.png"))}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],n=!0,r=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(r)throw o}}return a}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.initializeWatermark=function(e){var t=e.watermarkImageUrl,a=e.watermarkImageHeight;return console.log("Initialize Watermark",t),new Promise(function(e){if(t){var n=new Image;n.onload=function(t){var r=t.target,o=r.width,i=r.height,c=a?a/i:1;n.width=o*c,n.height=i*c,e({watermarkImage:n})},n.onerror=function(){e({watermarkImage:new Image,error:"Unable to resolve image with url "+t})},n.src=t}else e({watermarkImage:new Image})})};t.applyWatermark=function(e){var t=e.watermarkImage,a=e.context,o=e.watermarkImagePosition,i=e.gap;if(console.log("applyWatermark",t),t){var c=r({watermarkImagePosition:o,imageWidth:t.width,imageHeight:t.height,canvas:a.canvas,gap:i}),s=n(c,2),u=s[0],l=s[1];a.drawImage(t,u,l,t.width,t.height)}};var r=function(e){var t=e.watermarkImagePosition,a=e.imageWidth,n=e.imageHeight,r=e.canvas,o=r.width,i=r.height,c=e.gap,s=void 0===c?10:c,u=s,l=s,d=o/2-a/2,p=i/2-n/2,f=0+u,m=0+l,h=o-a-u,v=i-n-l;switch(console.log({watermarkImagePosition:t,imageWidth:a,imageHeight:n,canvasWidth:o,canvasHeight:i,offsetX:u,offsetY:l,xRight:h}),t){case"top-left":return[f,m];case"top-center":return[d,m];case"top-right":return[h,m];case"bottom-left":return[f,v];case"bottom-center":return[d,v];case"bottom-right":return[h,v];case"center":return[d,p];default:return[0+s,0+s]}};t.getCoordinates=r},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.properties={enabled:{schema:{type:"boolean"},default:!1},snapRequested:{default:"",schema:{type:"string"}},countdownDurationSeconds:{default:0,schema:{type:"number"}},pauseDurationSeconds:{default:1,schema:{type:"number"}},imageSize:{default:{width:800,height:600},schema:{type:"object",properties:{width:{type:"integer"},height:{type:"integer"}},required:["width","height"]}},gap:{default:10,schema:{type:"number"}},chin:{default:50,schema:{type:"number"}},fillStyle:{default:"lightgreen",schema:{type:"string"}},cameraDeviceId:{default:"",schema:{type:"string"}},watermarkImageUrl:{schema:{type:"string"},default:""},watermarkImagePosition:{schema:{type:"string",enum:["top-left","top-center","top-right","bottom-left","bottom-center","bottom-right","center"]},default:"bottom-center"},watermarkImageHeight:{schema:{type:"number"},default:null},shutterSoundFile:{schema:{type:"string"},default:""},refreshRequested:{schema:{type:"string"},default:""}}},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var a=function(e,t){var a=e[1]||"",n=e[3];if(!n)return a;if(t&&"function"==typeof btoa){var r=function(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}(n),o=n.sources.map(function(e){return"/*# sourceURL="+n.sourceRoot+e+" */"});return[a].concat(o).concat([r]).join("\n")}return[a].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+a+"}":a}).join("")},t.i=function(e,a){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},r=0;r<this.length;r++){var o=this[r][0];"number"==typeof o&&(n[o]=!0)}for(r=0;r<e.length;r++){var i=e[r];"number"==typeof i[0]&&n[i[0]]||(a&&!i[2]?i[2]=a:a&&(i[2]="("+i[2]+") and ("+a+")"),t.push(i))}},t}},function(e,t,a){(e.exports=a(6)(!1)).push([e.i,':host{box-sizing:border-box;line-height:var(--now-line-height,1.25);font-family:var(--now-font-family,"Source Sans Pro",sans-serif)}:host([hidden]){display:none}*,:after,:before{box-sizing:border-box}@keyframes flasher{0%{background-color:#fff}25%{background-color:#fff}to{background-color:none}}#flash{position:absolute;width:100%;height:100%;top:0;left:0;z-index:1000}.snapping #flash{display:default;animation:flasher}#container{position:relative;align-items:center;justify-content:center;box-sizing:border-box}#container div{position:absolute}.countdown #counter,.countdown #flash,.idle #counter,.idle #flash{display:none}.snapping #counter,.snapping #flash{display:default}.preview #counter{display:none}',""])},function(e,t,a){var n=a(7);e.exports="string"==typeof n?n:n.toString()},function(e,t){e.exports=__TECTONIC__$servicenow_ui_core},function(e,t,a){"use strict";var n,r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},o=(a(0),a(0)),i=m(o),c=a(9),s=m(a(8)),u=a(5),l=a(4),d=a(3),p=a(2),f=a(1);function m(e){return e&&e.__esModule?e:{default:e}}function h(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var v=c.actionTypes.COMPONENT_CONNECTED,g=c.actionTypes.COMPONENT_PROPERTY_CHANGED,O=c.actionTypes.COMPONENT_DOM_READY,b={snapRequested:function(e){var t=e.state,a=e.dispatch,n=e.updateState,o=e.payload,i=o.value,c=o.previousValue,s=t.watermarkImage,u=t.properties;i!=c&&(console.log("SNAP STARTED"),(0,p.snap)({state:t,updateState:n}).then(function(e){var t=e.context,n=e.singleSnapContexts;console.log("SNAP COMPLETED",{context:t,singleSnapContexts:n}),(0,l.applyWatermark)(r({context:t,watermarkImage:s},u));var o=t.canvas.toDataURL("image/jpeg");a(f.PHOTOBOOTH_CAMERA_SNAPPED,{imageData:o});var i=n.map(function(e){return e.canvas.toDataURL("image/jpeg")});a(f.PHOTOBOOTH_CAMERA_SINGLES_SNAPPED,{individualSnaps:i})}))},enabled:function(e){var t=e.state.video,a=e.payload.value,n=e.properties.cameraDeviceId,r=e.dispatch;a&!t.srcObject?(0,p.selectMediaDevice)({video:t,cameraDeviceId:n,enabled:a}).then(function(){(0,p.getConnectedDevices)({cameraDeviceId:n}).then(function(e){console.log(f.PHOTOBOOTH_AVAILABLE_CAMERAS_UPDATED,e),r(f.PHOTOBOOTH_AVAILABLE_CAMERAS_UPDATED,e)}).catch(function(e){console.log("ERROR getConnectedDevices",e),r(f.PHOTOBOOTH_AVAILABLE_CAMERAS_UPDATED,e)})}).catch(function(e){console.log("ERROR selectMediaDevice",e)}):(0,p.toggleTracks)({video:t,enabled:a})},cameraDeviceId:function(e){var t=e.state.video,a=e.payload.value,n=(e.updateState,e.properties.enabled);n&&(0,p.selectMediaDevice)({video:t,cameraDeviceId:a,enabled:n})},watermarkImageUrl:function(e){var t=e.properties,a=e.updateState;(0,l.initializeWatermark)(t).then(function(e){var t=e.watermarkImage;e.error;a({watermarkImage:t})})},watermarkImageHeight:function(e){var t=e.properties,a=e.updateState;(0,l.initializeWatermark)(t).then(function(e){var t=e.watermarkImage;e.error;a({watermarkImage:t})})},refreshRequested:function(){console.log("REFRESH REQUESTED"),window.location.reload()}},_=(h(n={},O,function(e){var t=e.host,a=e.state.properties,n=e.updateState,r=e.dispatch;console.log(O,t,a),function(e){var t=e.host,a=e.updateState,n=(e.dispatch,e.properties),r=e.properties.shutterSoundFile;console.log("INITIALIZE MEDIA!"),(0,l.initializeWatermark)(n).then(function(e){var t=e.watermarkImage;e.error,a({watermarkImage:t})});var o=t.shadowRoot.getElementById("video"),i=t.shadowRoot.ownerDocument.createElement("canvas").getContext("2d");if(r){var c=new Audio(r);a({shutterSound:c})}a({video:o,context:i})}({host:t,properties:a,dispatch:r,updateState:n}),(0,d.setupAppMetadata)(window)}),h(n,v,function(e){var t=e.properties;console.log(v,t)}),h(n,g,function(e){var t=e.host,a=e.state,n=e.action.payload,r=n.name,o=n.value,i=n.previousValue,c=e.dispatch,s=e.updateState;console.log(g,{name:r,value:o}),b[r]&&b[r]({host:t,state:a,dispatch:c,updateState:s,payload:{value:o,previousValue:i},properties:a.properties})}),n);(0,c.createCustomElement)("snc-photobooth-uic-camera",{renderer:{type:i.default},view:function(e,t){var a=e.snapState,n=e.properties,r=n.pauseDurationSeconds,i=n.animationDuration,c=void 0===i?r+"s":i,s=t.dispatch;return(0,o.createElement)("div",{id:"container",className:a,"on-dblclick":function(e){var t=e.clientX,a=e.clientY;console.log(f.PHOTOBOOTH_CAMERA_DOUBLE_CLICK,{clientX:t,clientY:a}),s(f.PHOTOBOOTH_CAMERA_DOUBLE_CLICK,{clientX:t,clientY:a})}},(0,o.createElement)("div",{id:"flash",style:{"animation-iteration-count":4,"animation-duration":c}}),(0,o.createElement)("video",{id:"video",autoplay:!0,muted:!0,style:{width:"100%"}}))},styles:s.default,initialState:{snapState:"idle",watermarkImage:null},actionHandlers:_,dispatches:{PHOTOBOOTH_CAMERA_SNAPPED:{},PHOTOBOOTH_CAMERA_SINGLES_SNAPPED:{},PHOTOBOOTH_AVAILABLE_CAMERAS_UPDATED:{},PHOTOBOOTH_CAMERA_DOUBLE_CLICK:{}},properties:u.properties})},function(e,t,a){"use strict";a(10)},function(e,t,a){e.exports=a(11)}]);]]></script>
        <script_link/>
        <sys_class_name>sys_ux_lib_source_script</sys_class_name>
        <sys_created_by>jon.lind</sys_created_by>
        <sys_created_on>2022-09-26 21:38:20</sys_created_on>
        <sys_id>6f69abc99a2e1277aa55dd9a07909e8d</sys_id>
        <sys_mod_count>467058</sys_mod_count>
        <sys_name>@snc/photobooth-uic-camera</sys_name>
        <sys_package display_value="Photobooth UIC Camera" source="x_snc_pb_camera">fe8710bf47ce9d10552caf52736d432a</sys_package>
        <sys_policy/>
        <sys_scope display_value="Photobooth UIC Camera">fe8710bf47ce9d10552caf52736d432a</sys_scope>
        <sys_update_name>sys_ux_lib_source_script_6f69abc99a2e1277aa55dd9a07909e8d</sys_update_name>
        <sys_updated_by>jon.lind</sys_updated_by>
        <sys_updated_on>2023-04-13 17:32:03</sys_updated_on>
        <type>script</type>
    </sys_ux_lib_source_script>
</record_update>
